Object.defineProperty(exports, "__esModule", {
    value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _ignore = require("ignore");

var _ignore2 = _interopRequireDefault(_ignore);

var _atom = require("atom");

var _jquery = require("jquery");

var _jquery2 = _interopRequireDefault(_jquery);

"use babel";

var oPackageConfig = undefined,
    fActivate = undefined,
    fDeactivate = undefined,
    _oDisposables = undefined,
    _oAtomIgnoreFileDisposables = undefined,
    _oMutationObserver = undefined,
    _bIsWindowsPlatform = document.body.classList.contains("platform-win32"),
    _oAtomIgnoreFiles = undefined,
    _fUpdate = undefined,
    _fApply = undefined,
    _fTreeViewHasMutated = undefined,
    _fProjectChangedPaths = undefined,
    _fGetCurrentState = undefined,
    _fAddAtomIgnoreFiles = undefined,
    _fNormalizePath = undefined,
    _fHandleIgnoreFile = undefined,
    _fUnhideParents = undefined;

exports.config = oPackageConfig = {
    "enabled": {
        "type": "boolean",
        "default": true
    },
    "ignoreFileName": {
        "type": "string",
        "default": ".atomignore"
    }
};

exports.activate = fActivate = function () {
    _oDisposables && _oDisposables.dispose();
    _oDisposables = new _atom.CompositeDisposable();

    _oDisposables.add(atom.commands.add("atom-workspace", {
        "tree-ignore:toggle": function treeIgnoreToggle() {
            _fApply(!atom.config.get("tree-ignore.enabled"));
        },
        "tree-ignore:enable": _fApply.bind(null, true),
        "tree-ignore:disable": _fApply.bind(null, false)
    }));

    _oDisposables.add(atom.commands.add(".platform-win32, .platform-linux, .platform-darwin", {
        "tree-view:toggle": _fUpdate.bind(null)
    }));

    _oMutationObserver = new MutationObserver(_fTreeViewHasMutated);

    atom.packages.onDidActivateInitialPackages(function () {
        _oDisposables.add(atom.project.onDidChangePaths(_fProjectChangedPaths));

        _fProjectChangedPaths();

        atom.config.observe("tree-ignore.enabled", function (bNewValue) {
            if (bNewValue !== atom.config.get("tree-ignore.enabled")) {
                _fApply(bNewValue);
            }
        });

        _fUpdate();
    });
};

exports.deactivate = fDeactivate = function () {
    _oDisposables && _oDisposables.dispose();
    _oAtomIgnoreFileDisposables && _oAtomIgnoreFileDisposables.dispose();
    _oMutationObserver.disconnect();
};

_fGetCurrentState = function () {
    return atom.config.get("tree-ignore.enabled");
};

_fApply = function (bValue) {
    atom.config.set("tree-ignore.enabled", bValue);
    _fUpdate();
};

_fUpdate = function () {
    var oIgnore = undefined,
        oIgnoredItems = {},
        sProjectRoot = "",
        bHandleProject = undefined,
        bState = _fGetCurrentState();

    if (bState && document.querySelector(".tree-view")) {
        _oMutationObserver.observe(document.querySelector(".tree-view"), {
            "childList": true,
            "subtree": true
        });
    } else {
        _oMutationObserver.disconnect();
    }

    (0, _jquery2["default"])(atom.views.getView(atom.workspace)).find(".tree-view li.entry .name").each(function () {
        var sPath = undefined,
            $this = undefined,
            bFiltered = false;

        if (sPath = ($this = (0, _jquery2["default"])(this)).data("path")) {
            var $parent = $this.parents("li.entry").first();

            sPath = _fNormalizePath(sPath);
            if ($parent.hasClass("directory")) {
                sPath += "/";
            }
            if ($parent.hasClass("project-root")) {
                sProjectRoot = sPath;
                oIgnore = _fHandleIgnoreFile(sProjectRoot);
                bHandleProject = oIgnore != null;
            }
            if (oIgnore != null) {
                sPath = sPath.substring(sProjectRoot.length);
                bFiltered = oIgnore.filter([sPath]).length === 0;
                if (bFiltered) {
                    if (sPath.endsWith("/")) {
                        oIgnoredItems[sPath] = $parent;
                    }
                } else {
                    _fUnhideParents(oIgnoredItems, sPath);
                }
            }
            $parent.toggleClass("tree-ignore-element", bState && bHandleProject && bFiltered);
        }
    });
};

_fTreeViewHasMutated = function () {
    _fUpdate();
};

_fProjectChangedPaths = function () {
    _fAddAtomIgnoreFiles();
    _fUpdate();
};

_fAddAtomIgnoreFiles = function () {
    var sIgnoreFileName = atom.config.get("tree-ignore.ignoreFileName");

    _oAtomIgnoreFileDisposables && _oAtomIgnoreFileDisposables.dispose();
    _oAtomIgnoreFileDisposables = new _atom.CompositeDisposable();
    _oAtomIgnoreFiles = {};

    atom.project.getDirectories().forEach(function (oDirectory) {
        var oIgnoreFile = oDirectory.getFile(sIgnoreFileName);

        _oAtomIgnoreFiles[_fNormalizePath(oDirectory.getPath() + "/")] = oIgnoreFile;
        _oAtomIgnoreFileDisposables.add(oIgnoreFile.onDidChange(_fUpdate));
    });
};

_fNormalizePath = function (sPath) {
    if (_bIsWindowsPlatform) {
        return sPath.replace(/\\/g, "/");
    }
    return sPath;
};

_fHandleIgnoreFile = function (sPath) {
    var sIgnoreFile = _oAtomIgnoreFiles[sPath];

    if (sIgnoreFile == null) {
        // New root / project path, look if it has an ignore file
        return null; // Don't handle this project
    }
    if (!sIgnoreFile.existsSync()) {
        return null; // Removed, unhide everything
    }

    return (0, _ignore2["default"])().addIgnoreFile(sIgnoreFile.getPath());
};

_fUnhideParents = function (oIgnoredItems, sPath) {
    var getParent = function getParent(sChildPath) {
        if (sChildPath.endsWith("/")) {
            return sChildPath.replace(/[^\/]*\/$/, "");
        }
        return sChildPath.replace(/\/.*?$/, "/");
    };
    var sParent = sPath,
        oItem = undefined;

    while (sParent.includes("/")) {
        sParent = getParent(sParent);
        oItem = oIgnoredItems[sParent];
        if (oItem != null) {
            oItem.removeClass("tree-ignore-element");
        }
    }
};

exports.config = oPackageConfig;
exports.activate = fActivate;
exports.deactivate = fDeactivate;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2xvaWMvLmF0b20vcGFja2FnZXMvdHJlZS1pZ25vcmUvbGliL3RyZWUtaWdub3JlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztzQkFFbUIsUUFBUTs7OztvQkFDUyxNQUFNOztzQkFDNUIsUUFBUTs7OztBQUp0QixXQUFXLENBQUM7O0FBTVosSUFBSSxjQUFjLFlBQUE7SUFDZCxTQUFTLFlBQUE7SUFBRSxXQUFXLFlBQUE7SUFDdEIsYUFBYSxZQUFBO0lBQUUsMkJBQTJCLFlBQUE7SUFDMUMsa0JBQWtCLFlBQUE7SUFDbEIsbUJBQW1CLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFFLGdCQUFnQixDQUFFO0lBQzFFLGlCQUFpQixZQUFBO0lBQ2pCLFFBQVEsWUFBQTtJQUFFLE9BQU8sWUFBQTtJQUFFLG9CQUFvQixZQUFBO0lBQUUscUJBQXFCLFlBQUE7SUFBRSxpQkFBaUIsWUFBQTtJQUNqRixvQkFBb0IsWUFBQTtJQUFFLGVBQWUsWUFBQTtJQUFFLGtCQUFrQixZQUFBO0lBQUUsZUFBZSxZQUFBLENBQUM7O0FBRS9FLFFBNktzQixNQUFNLEdBN0s1QixjQUFjLEdBQUc7QUFDYixhQUFTLEVBQUU7QUFDUCxjQUFNLEVBQUUsU0FBUztBQUNqQixpQkFBUyxFQUFFLElBQUk7S0FDbEI7QUFDRCxvQkFBZ0IsRUFBRTtBQUNkLGNBQU0sRUFBRSxRQUFRO0FBQ2hCLGlCQUFTLEVBQUUsYUFBYTtLQUMzQjtDQUNKLENBQUM7O0FBRUYsUUFtS2lCLFFBQVEsR0FuS3pCLFNBQVMsR0FBRyxZQUFXO0FBQ25CLGlCQUFhLElBQUksYUFBYSxDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQ3pDLGlCQUFhLEdBQUcsK0JBQXlCLENBQUM7O0FBRTFDLGlCQUFhLENBQUMsR0FBRyxDQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFFLGdCQUFnQixFQUFFO0FBQ3BELDRCQUFvQixFQUFFLDRCQUFNO0FBQ3hCLG1C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QWEsQ0FBRSxXQUFXLENBQUMsT0FBTyxFQUFFLENBQUUsQ0FBQztDQUMxRCxDQUFDOztBQUVGLGVBQWUsR0FBRyxVQUFVLGFBQWEsRUFBRSxLQUFLLEVBQUc7QUFDL0MsUUFBTSxTQUFTLEdBQUcsU0FBWixTQUFTLENBQWEsVUFBVSxFQUFHO0FBQ3JDLFlBQUssVUFBVSxDQUFDLFFBQVEsQ0FBRSxHQUFHLENBQUUsRUFBRztBQUM5QixtQkFBTyxVQUFVLENBQUMsT0FBTyxDQUFFLFdBQVcsRUFBRSxFQUFFLENBQUUsQ0FBQztTQUNoRDtBQUNELGVBQU8sVUFBVSxDQUFDLE9BQU8sQ0FBRSxRQUFRLEVBQUUsR0FBRyxDQUFFLENBQUM7S0FDOUMsQ0FBQztBQUNGLFFBQUksT0FBTyxHQUFHLEtBQUs7UUFBRSxLQUFLLFlBQUEsQ0FBQzs7QUFFM0IsV0FBUSxPQUFPLENBQUMsUUFBUSxDQUFFLEdBQUcsQ0FBRSxFQUFHO0FBQzlCLGVBQU8sR0FBRyxTQUFTLENBQUUsT0FBTyxDQUFFLENBQUM7QUFDL0IsYUFBSyxHQUFHLGFBQWEsQ0FBRSxPQUFPLENBQUUsQ0FBQztBQUNqQyxZQUFLLEtBQUssSUFBSSxJQUFJLEVBQUc7QUFDakIsaUJBQUssQ0FBQyxXQUFXLENBQUUscUJBQXFCLENBQUUsQ0FBQztTQUM5QztLQUNKO0NBQ0osQ0FBQzs7UUFHb0IsTUFBTSxHQUF4QixjQUFjO1FBQ0QsUUFBUSxHQUFyQixTQUFTO1FBQ00sVUFBVSxHQUF6QixXQUFXIiwiZmlsZSI6Ii9ob21lL2xvaWMvLmF0b20vcGFja2FnZXMvdHJlZS1pZ25vcmUvbGliL3RyZWUtaWdub3JlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2UgYmFiZWxcIjtcblxuaW1wb3J0IGlnbm9yZSBmcm9tIFwiaWdub3JlXCI7XG5pbXBvcnQgeyBDb21wb3NpdGVEaXNwb3NhYmxlIH0gZnJvbSBcImF0b21cIjtcbmltcG9ydCAkIGZyb20gXCJqcXVlcnlcIjtcblxubGV0IG9QYWNrYWdlQ29uZmlnLFxuICAgIGZBY3RpdmF0ZSwgZkRlYWN0aXZhdGUsXG4gICAgX29EaXNwb3NhYmxlcywgX29BdG9tSWdub3JlRmlsZURpc3Bvc2FibGVzLFxuICAgIF9vTXV0YXRpb25PYnNlcnZlcixcbiAgICBfYklzV2luZG93c1BsYXRmb3JtID0gZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoIFwicGxhdGZvcm0td2luMzJcIiApLFxuICAgIF9vQXRvbUlnbm9yZUZpbGVzLFxuICAgIF9mVXBkYXRlLCBfZkFwcGx5LCBfZlRyZWVWaWV3SGFzTXV0YXRlZCwgX2ZQcm9qZWN0Q2hhbmdlZFBhdGhzLCBfZkdldEN1cnJlbnRTdGF0ZSxcbiAgICBfZkFkZEF0b21JZ25vcmVGaWxlcywgX2ZOb3JtYWxpemVQYXRoLCBfZkhhbmRsZUlnbm9yZUZpbGUsIF9mVW5oaWRlUGFyZW50cztcblxub1BhY2thZ2VDb25maWcgPSB7XG4gICAgXCJlbmFibGVkXCI6IHtcbiAgICAgICAgXCJ0eXBlXCI6IFwiYm9vbGVhblwiLFxuICAgICAgICBcImRlZmF1bHRcIjogdHJ1ZVxuICAgIH0sXG4gICAgXCJpZ25vcmVGaWxlTmFtZVwiOiB7XG4gICAgICAgIFwidHlwZVwiOiBcInN0cmluZ1wiLFxuICAgICAgICBcImRlZmF1bHRcIjogXCIuYXRvbWlnbm9yZVwiXG4gICAgfVxufTtcblxuZkFjdGl2YXRlID0gZnVuY3Rpb24oKSB7XG4gICAgX29EaXNwb3NhYmxlcyAmJiBfb0Rpc3Bvc2FibGVzLmRpc3Bvc2UoKTtcbiAgICBfb0Rpc3Bvc2FibGVzID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcblxuICAgIF9vRGlzcG9zYWJsZXMuYWRkKCBhdG9tLmNvbW1hbmRzLmFkZCggXCJhdG9tLXdvcmtzcGFjZVwiLCB7XG4gICAgICAgIFwidHJlZS1pZ25vcmU6dG9nZ2xlXCI6ICgpID0+IHtcbiAgICAgICAgICAgIF9mQXBwbHkoICFhdG9tLmNvbmZpZy5nZXQoIFwidHJlZS1pZ25vcmUuZW5hYmxlZFwiICkgKTtcbiAgICAgICAgfSxcbiAgICAgICAgXCJ0cmVlLWlnbm9yZTplbmFibGVcIjogX2ZBcHBseS5iaW5kKCBudWxsLCB0cnVlICksXG4gICAgICAgIFwidHJlZS1pZ25vcmU6ZGlzYWJsZVwiOiBfZkFwcGx5LmJpbmQoIG51bGwsIGZhbHNlIClcbiAgICB9ICkgKTtcblxuICAgIF9vRGlzcG9zYWJsZXMuYWRkKCBhdG9tLmNvbW1hbmRzLmFkZCggXCIucGxhdGZvcm0td2luMzIsIC5wbGF0Zm9ybS1saW51eCwgLnBsYXRmb3JtLWRhcndpblwiLCB7XG4gICAgICAgIFwidHJlZS12aWV3OnRvZ2dsZVwiOiBfZlVwZGF0ZS5iaW5kKCBudWxsIClcbiAgICB9ICkgKTtcblxuICAgIF9vTXV0YXRpb25PYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKCBfZlRyZWVWaWV3SGFzTXV0YXRlZCApO1xuXG4gICAgYXRvbS5wYWNrYWdlcy5vbkRpZEFjdGl2YXRlSW5pdGlhbFBhY2thZ2VzKCAoKSA9PiB7XG4gICAgICAgIF9vRGlzcG9zYWJsZXMuYWRkKCBhdG9tLnByb2plY3Qub25EaWRDaGFuZ2VQYXRocyggX2ZQcm9qZWN0Q2hhbmdlZFBhdGhzICkgKTtcblxuICAgICAgICBfZlByb2plY3RDaGFuZ2VkUGF0aHMoKTtcblxuICAgICAgICBhdG9tLmNvbmZpZy5vYnNlcnZlKCBcInRyZWUtaWdub3JlLmVuYWJsZWRcIiwgKCBiTmV3VmFsdWUgKSA9PiB7XG4gICAgICAgICAgICBpZiAoIGJOZXdWYWx1ZSAhPT0gYXRvbS5jb25maWcuZ2V0KCBcInRyZWUtaWdub3JlLmVuYWJsZWRcIiApICkge1xuICAgICAgICAgICAgICAgIF9mQXBwbHkoIGJOZXdWYWx1ZSApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9ICk7XG5cbiAgICAgICAgX2ZVcGRhdGUoKTtcbiAgICB9ICk7XG59O1xuXG5mRGVhY3RpdmF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIF9vRGlzcG9zYWJsZXMgJiYgX29EaXNwb3NhYmxlcy5kaXNwb3NlKCk7XG4gICAgX29BdG9tSWdub3JlRmlsZURpc3Bvc2FibGVzICYmIF9vQXRvbUlnbm9yZUZpbGVEaXNwb3NhYmxlcy5kaXNwb3NlKCk7XG4gICAgX29NdXRhdGlvbk9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbn07XG5cbl9mR2V0Q3VycmVudFN0YXRlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGF0b20uY29uZmlnLmdldCggXCJ0cmVlLWlnbm9yZS5lbmFibGVkXCIgKTtcbn07XG5cbl9mQXBwbHkgPSBmdW5jdGlvbiggYlZhbHVlICkge1xuICAgIGF0b20uY29uZmlnLnNldCggXCJ0cmVlLWlnbm9yZS5lbmFibGVkXCIsIGJWYWx1ZSApO1xuICAgIF9mVXBkYXRlKCk7XG59O1xuXG5fZlVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIGxldCBvSWdub3JlLFxuICAgICAgICBvSWdub3JlZEl0ZW1zID0ge30sXG4gICAgICAgIHNQcm9qZWN0Um9vdCA9IFwiXCIsXG4gICAgICAgIGJIYW5kbGVQcm9qZWN0LFxuICAgICAgICBiU3RhdGUgPSBfZkdldEN1cnJlbnRTdGF0ZSgpO1xuXG4gICAgaWYgKCBiU3RhdGUgJiYgZG9jdW1lbnQucXVlcnlTZWxlY3RvciggXCIudHJlZS12aWV3XCIgKSApIHtcbiAgICAgICAgX29NdXRhdGlvbk9ic2VydmVyLm9ic2VydmUoIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIFwiLnRyZWUtdmlld1wiICksIHtcbiAgICAgICAgICAgIFwiY2hpbGRMaXN0XCI6IHRydWUsXG4gICAgICAgICAgICBcInN1YnRyZWVcIjogdHJ1ZVxuICAgICAgICB9ICk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgX29NdXRhdGlvbk9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICB9XG5cbiAgICAkKCBhdG9tLnZpZXdzLmdldFZpZXcoIGF0b20ud29ya3NwYWNlICkgKVxuICAgICAgICAuZmluZCggXCIudHJlZS12aWV3IGxpLmVudHJ5IC5uYW1lXCIgKS5lYWNoKCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGxldCBzUGF0aCxcbiAgICAgICAgICAgICAgICAkdGhpcyxcbiAgICAgICAgICAgICAgICBiRmlsdGVyZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgaWYgKCBzUGF0aCA9ICggJHRoaXMgPSAkKCB0aGlzICkgKS5kYXRhKCBcInBhdGhcIiApICkge1xuICAgICAgICAgICAgICAgIGxldCAkcGFyZW50ID0gJHRoaXMucGFyZW50cyggXCJsaS5lbnRyeVwiICkuZmlyc3QoKTtcblxuICAgICAgICAgICAgICAgIHNQYXRoID0gX2ZOb3JtYWxpemVQYXRoKCBzUGF0aCApO1xuICAgICAgICAgICAgICAgIGlmICggJHBhcmVudC5oYXNDbGFzcyggXCJkaXJlY3RvcnlcIiApICkge1xuICAgICAgICAgICAgICAgICAgICBzUGF0aCArPSBcIi9cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCAkcGFyZW50Lmhhc0NsYXNzKCBcInByb2plY3Qtcm9vdFwiICkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHNQcm9qZWN0Um9vdCA9IHNQYXRoO1xuICAgICAgICAgICAgICAgICAgICBvSWdub3JlID0gX2ZIYW5kbGVJZ25vcmVGaWxlKCBzUHJvamVjdFJvb3QgKTtcbiAgICAgICAgICAgICAgICAgICAgYkhhbmRsZVByb2plY3QgPSBvSWdub3JlICE9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICggb0lnbm9yZSAhPSBudWxsICkge1xuICAgICAgICAgICAgICAgICAgICBzUGF0aCA9IHNQYXRoLnN1YnN0cmluZyggc1Byb2plY3RSb290Lmxlbmd0aCApO1xuICAgICAgICAgICAgICAgICAgICBiRmlsdGVyZWQgPSBvSWdub3JlLmZpbHRlciggWyBzUGF0aCBdICkubGVuZ3RoID09PSAwO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIGJGaWx0ZXJlZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc1BhdGguZW5kc1dpdGgoIFwiL1wiICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb0lnbm9yZWRJdGVtc1sgc1BhdGggXSA9ICRwYXJlbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfZlVuaGlkZVBhcmVudHMoIG9JZ25vcmVkSXRlbXMsIHNQYXRoICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJHBhcmVudC50b2dnbGVDbGFzcyggXCJ0cmVlLWlnbm9yZS1lbGVtZW50XCIsIGJTdGF0ZSAmJiBiSGFuZGxlUHJvamVjdCAmJiBiRmlsdGVyZWQgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSApO1xufTtcblxuX2ZUcmVlVmlld0hhc011dGF0ZWQgPSBmdW5jdGlvbigpIHtcbiAgICBfZlVwZGF0ZSgpO1xufTtcblxuX2ZQcm9qZWN0Q2hhbmdlZFBhdGhzID0gZnVuY3Rpb24oKSB7XG4gICAgX2ZBZGRBdG9tSWdub3JlRmlsZXMoKTtcbiAgICBfZlVwZGF0ZSgpO1xufTtcblxuX2ZBZGRBdG9tSWdub3JlRmlsZXMgPSBmdW5jdGlvbigpIHtcbiAgICBsZXQgc0lnbm9yZUZpbGVOYW1lID0gYXRvbS5jb25maWcuZ2V0KCBcInRyZWUtaWdub3JlLmlnbm9yZUZpbGVOYW1lXCIgKTtcblxuICAgIF9vQXRvbUlnbm9yZUZpbGVEaXNwb3NhYmxlcyAmJiBfb0F0b21JZ25vcmVGaWxlRGlzcG9zYWJsZXMuZGlzcG9zZSgpO1xuICAgIF9vQXRvbUlnbm9yZUZpbGVEaXNwb3NhYmxlcyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG4gICAgX29BdG9tSWdub3JlRmlsZXMgPSB7fTtcblxuICAgIGF0b20ucHJvamVjdC5nZXREaXJlY3RvcmllcygpLmZvckVhY2goICggb0RpcmVjdG9yeSApID0+IHtcbiAgICAgICAgbGV0IG9JZ25vcmVGaWxlID0gb0RpcmVjdG9yeS5nZXRGaWxlKCBzSWdub3JlRmlsZU5hbWUgKTtcblxuICAgICAgICBfb0F0b21JZ25vcmVGaWxlc1sgX2ZOb3JtYWxpemVQYXRoKCBgJHsgb0RpcmVjdG9yeS5nZXRQYXRoKCkgfS9gICkgXSA9IG9JZ25vcmVGaWxlO1xuICAgICAgICBfb0F0b21JZ25vcmVGaWxlRGlzcG9zYWJsZXMuYWRkKCBvSWdub3JlRmlsZS5vbkRpZENoYW5nZSggX2ZVcGRhdGUgKSApO1xuICAgIH0gKTtcbn07XG5cbl9mTm9ybWFsaXplUGF0aCA9IGZ1bmN0aW9uKCBzUGF0aCApIHtcbiAgICBpZiAoIF9iSXNXaW5kb3dzUGxhdGZvcm0gKSB7XG4gICAgICAgIHJldHVybiBzUGF0aC5yZXBsYWNlKCAvXFxcXC9nLCBcIi9cIiApO1xuICAgIH1cbiAgICByZXR1cm4gc1BhdGg7XG59O1xuXG5fZkhhbmRsZUlnbm9yZUZpbGUgPSBmdW5jdGlvbiggc1BhdGggKSB7XG4gICAgbGV0IHNJZ25vcmVGaWxlID0gX29BdG9tSWdub3JlRmlsZXNbIHNQYXRoIF07XG5cbiAgICBpZiAoIHNJZ25vcmVGaWxlID09IG51bGwgKSB7XG4gICAgICAgIC8vIE5ldyByb290IC8gcHJvamVjdCBwYXRoLCBsb29rIGlmIGl0IGhhcyBhbiBpZ25vcmUgZmlsZVxuICAgICAgICByZXR1cm4gbnVsbDsgLy8gRG9uJ3QgaGFuZGxlIHRoaXMgcHJvamVjdFxuICAgIH1cbiAgICBpZiAoICFzSWdub3JlRmlsZS5leGlzdHNTeW5jKCkgKSB7XG4gICAgICAgIHJldHVybiBudWxsOyAvLyBSZW1vdmVkLCB1bmhpZGUgZXZlcnl0aGluZ1xuICAgIH1cblxuICAgIHJldHVybiBpZ25vcmUoKS5hZGRJZ25vcmVGaWxlKCBzSWdub3JlRmlsZS5nZXRQYXRoKCkgKTtcbn07XG5cbl9mVW5oaWRlUGFyZW50cyA9IGZ1bmN0aW9uKCBvSWdub3JlZEl0ZW1zLCBzUGF0aCApIHtcbiAgICBjb25zdCBnZXRQYXJlbnQgPSBmdW5jdGlvbiggc0NoaWxkUGF0aCApIHtcbiAgICAgICAgaWYgKCBzQ2hpbGRQYXRoLmVuZHNXaXRoKCBcIi9cIiApICkge1xuICAgICAgICAgICAgcmV0dXJuIHNDaGlsZFBhdGgucmVwbGFjZSggL1teXFwvXSpcXC8kLywgXCJcIiApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzQ2hpbGRQYXRoLnJlcGxhY2UoIC9cXC8uKj8kLywgXCIvXCIgKTtcbiAgICB9O1xuICAgIGxldCBzUGFyZW50ID0gc1BhdGgsIG9JdGVtO1xuXG4gICAgd2hpbGUgKCBzUGFyZW50LmluY2x1ZGVzKCBcIi9cIiApICkge1xuICAgICAgICBzUGFyZW50ID0gZ2V0UGFyZW50KCBzUGFyZW50ICk7XG4gICAgICAgIG9JdGVtID0gb0lnbm9yZWRJdGVtc1sgc1BhcmVudCBdO1xuICAgICAgICBpZiAoIG9JdGVtICE9IG51bGwgKSB7XG4gICAgICAgICAgICBvSXRlbS5yZW1vdmVDbGFzcyggXCJ0cmVlLWlnbm9yZS1lbGVtZW50XCIgKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbmV4cG9ydCB7XG4gICAgb1BhY2thZ2VDb25maWcgYXMgY29uZmlnLFxuICAgIGZBY3RpdmF0ZSBhcyBhY3RpdmF0ZSxcbiAgICBmRGVhY3RpdmF0ZSBhcyBkZWFjdGl2YXRlXG59O1xuIl19
//# sourceURL=/home/loic/.atom/packages/tree-ignore/lib/tree-ignore.js
